{"version":3,"sources":["../../../../assets/scripts/assets/scripts/gameLogic.js"],"names":["cc","Class","extends","Component","properties","spawnFishDt","fishPrefab","default","type","Prefab","fishMoveDuration","dollorLabelPrefab","catchedFishAnimTime","getFishNodeOriginPosition","visible","fishesNode","Node","getFishNode","dollorLabelesNode","catchedFishesNode","currentDollorLabel","Label","dataCenter","onLoad","require","setUpPlayerDataFromServer","setUpPerformanceByData","node","on","touchBegan","touchMoved","touchEnd","touchCancel","schedule","spwanOneFish","getPosition","start","event","x","getLocationX","y","getLocationY","location","convertToNodeSpaceAR","v2","setPosition","motionComponent","getComponent","MotionStreak","enabled","motion","onDestroy","off","newFish","instantiate","spawnAreaNum","Math","random","floor","targetSpawnAreaNum","spawnPosition","getOneRandomPositionBySpawnArea","addChild","targetPositon","helper","turnOneNodeToOnePosition","swimLeft","rotateBy","leftBack","swimRight","rightBack","swimAction","sequence","swimAnimation","repeatForever","runAction","moveAction","moveTo","fishAction","removeSelf","spawnX","spawnY","width","height","update","dt","fishes","children","fishesMgr","length","isOneNodeInAnotherNode","fishConfig","fishConfigs","dollor","playerData","currentDollor","storePlayerData","position","removeFromParent","splice","catchedFish","catchedFishTargetPosition","jumpAction","jumpTo","scaleUpAction","scaleTo","scaleDownAction","scalAction","action","spawn","newLabel","fadeOut","text","formatNumberShowStyle","string","openTouchEvent","closeTouchEvent","startRefreshFishes","refreshRule","getRefreshRuleFromServerByAreaLevel","currentAreaLevel","rules","index","spwanOneFishByFishId","fishId","probability","timeDelta","givenFishId","isHittedByProbability","getFishConfigByFishId","loader","loadRes","err","targetAreaNum","getTargetAreaNumBySpawnAreaNum","push","givenNum","target"],"mappings":"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","file":"gameLogic.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        spawnFishDt: 5,\n        fishPrefab: {\n            default:null,\n            type: cc.Prefab,\n        },\n        fishMoveDuration: 5,\n        dollorLabelPrefab: {\n            default:null,\n            type: cc.Prefab,\n        },\n        catchedFishAnimTime: 0.5,\n        getFishNodeOriginPosition: {\n            default: null,\n            visible: false,\n        },\n        \n        fishesNode: {\n            default: null,\n            type: cc.Node,\n        },\n        getFishNode: {\n            default: null,\n            type: cc.Node,\n        },\n        dollorLabelesNode: {\n            default: null,\n            type: cc.Node,\n        },\n        catchedFishesNode: {\n            default: null,\n            type: cc.Node,\n        },\n        currentDollorLabel: cc.Label,\n\n        dataCenter: {\n            default: null,\n            visible: false\n        },\n\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n     onLoad () {\n        this.dataCenter = require(\"dataCenter\");\n        this.dataCenter.setUpPlayerDataFromServer();\n        this.setUpPerformanceByData();\n\n        this.node.on(\"touchstart\",this.touchBegan,this);\n        this.node.on(\"touchmove\",this.touchMoved,this);\n        this.node.on(\"touchend\",this.touchEnd,this);\n        this.node.on(\"touchcancel\",this.touchCancel,this);\n\n        this.schedule(function(){\n            this.spwanOneFish();\n        },this.spawnFishDt);\n\n        this.getFishNodeOriginPosition = this.getFishNode.getPosition();\n\n     },\n\n    start () {\n    },\n    touchBegan(event){\n        var x = event.getLocationX();\n        var y = event.getLocationY();\n        var location = this.node.convertToNodeSpaceAR(cc.v2(x,y));\n\n        this.getFishNode.setPosition(location.x,location.y);\n        var motionComponent = this.getFishNode.getComponent(cc.MotionStreak);\n        motionComponent.enabled = true;\n\n    },\n    touchMoved(event){\n        var x = event.getLocationX();\n        var y = event.getLocationY();\n        var location = this.node.convertToNodeSpaceAR(cc.v2(x,y));\n        this.getFishNode.setPosition(location.x,location.y);\n    },\n    touchEnd(event){\n        var motion = this.getFishNode.getComponent(cc.MotionStreak);\n        motion.enabled = false;\n        this.getFishNode.setPosition(this.getFishNodeOriginPosition);\n\n    },\n    touchCancel(event){\n        this.touchEnd();\n    },\n\n    onDestroy(){\n        this.node.off(\"touchstart\",this.touchBegan,this);\n        this.node.off(\"touchmove\",this.touchMoved,this);\n        this.node.off(\"touchend\",this.touchEnd,this);\n        this.node.off(\"touchcancel\",this.touchCancel,this); \n    },\n    spwanOneFish(){\n        var newFish = cc.instantiate(this.fishPrefab);\n        //select one spwan area. There are 4 areas for spwan , which are distributed of the screen's left,right,top and bottom\n        //0 -> left\n        //1 -> right\n        //2 -> top\n        //3 -> bottom\n        var spawnAreaNum = Math.random() * 4;\n        spawnAreaNum = Math.floor(spawnAreaNum);\n        var targetSpawnAreaNum = null;\n        switch(spawnAreaNum) {\n            case 0:\n                targetSpawnAreaNum = 1;\n                break;\n            case 1:\n                targetSpawnAreaNum = 0;\n                break;\n            case 2:\n                targetSpawnAreaNum = 3;\n                break;\n            case 3:\n                targetSpawnAreaNum = 2;\n                break;\n        }\n\n        //fish spwan position\n        var spawnPosition = this.getOneRandomPositionBySpawnArea(spawnAreaNum);\n        newFish.setPosition(spawnPosition);\n        this.fishesNode.addChild(newFish);\n\n        //let fish to face to it's target\n        var targetPositon = this.getOneRandomPositionBySpawnArea(targetSpawnAreaNum);\n        var helper = require(\"helper\");\n        helper.turnOneNodeToOnePosition(newFish,targetPositon);\n\n        //add animation of fish\n        var swimLeft = cc.rotateBy(0.5,30);\n        var leftBack = cc.rotateBy(0.5,-30);\n        var swimRight = cc.rotateBy(0.5,-30);\n        var rightBack = cc.rotateBy(0.5,30);\n        var swimAction = cc.sequence(swimLeft,leftBack,swimRight,rightBack);\n        var swimAnimation = cc.repeatForever(swimAction);\n        newFish.runAction(swimAnimation);\n\n        //let fish to move to it's target\n        var moveAction = cc.moveTo(this.fishMoveDuration,targetPositon);\n        var fishAction = cc.sequence(moveAction,cc.removeSelf());\n\n        newFish.runAction(fishAction);\n\n    },\n    getOneRandomPositionBySpawnArea(spawnAreaNum){\n        var spawnX = null;\n        var spawnY = null;\n        var newFish = cc.instantiate(this.fishPrefab);\n        if(spawnAreaNum == 0) {\n             spawnX = -1 * this.node.width/2 - newFish.width/2;\n             spawnY = Math.random() * this.node.height - this.node.height/2;\n        }\n        else if(spawnAreaNum == 1){\n            spawnX = this.node.width/2 + newFish.width/2;\n            spawnY = Math.random() * this.node.height - this.node.height/2;\n        }\n        else if(spawnAreaNum == 2) {\n            spawnY = this.node.height/2 + newFish.height/2;\n            spawnX = Math.random() * this.node.width - this.node.width/2;\n        }\n        else if(spawnAreaNum == 3) {\n            spawnY = -this.node.height/2 - newFish.height/2;\n            spawnX = Math.random() * this.node.width - this.node.width/2;\n        }\n        return cc.v2(spawnX,spawnY);\n    },\n    update (dt) {\n        var fishes = this.fishesNode.children;\n        var fishesMgr = this.fishesNode.getComponent(\"fishesMgr\");\n        var helper = require(\"helper\");\n        if (fishes.length > 0){\n            for(var x in fishes){\n                if (helper.isOneNodeInAnotherNode(this.getFishNode,fishes[x]) == true){ // catch one fish\n                    //data things\n                    var fishConfig = fishesMgr.fishConfigs[x];\n                    var dollor = fishConfig[1];\n                    this.dataCenter.playerData.currentDollor += dollor;\n                    this.dataCenter.storePlayerData();\n                    this.setUpPerformanceByData();\n                    //remove selected fish\n                    var position = fishes[x].getPosition();\n                    fishes[x].removeFromParent();\n                    fishesMgr.fishConfigs.splice(x,1);\n\n                    //setup catchedFish\n                    var catchedFish = cc.instantiate(this.fishPrefab);\n                    var catchedFishTargetPosition = cc.v2(0,-151);\n                    var jumpAction = cc.jumpTo(this.catchedFishAnimTime,catchedFishTargetPosition,50,1);\n                    var scaleUpAction = cc.scaleTo(0.3 * this.catchedFishAnimTime,1.5,1.5);\n                    var scaleDownAction = cc.scaleTo(0.7 * this.catchedFishAnimTime,0.5,0.5);\n                    var scalAction = cc.sequence(scaleUpAction,scaleDownAction,cc.removeSelf());\n                    var action = cc.spawn(jumpAction,scalAction);\n\n                    catchedFish.position = position;\n                    helper.turnOneNodeToOnePosition(catchedFish,catchedFishTargetPosition);\n                    this.catchedFishesNode.addChild(catchedFish);\n                    catchedFish.runAction(action);\n                    \n                    //setup dollorLabel\n                    var newLabel = cc.instantiate(this.dollorLabelPrefab);\n                    newLabel.setPosition(position);\n                    this.dollorLabelesNode.addChild(newLabel);\n                    var fadeOut = cc.fadeOut(1.0);\n                    var action = cc.sequence(fadeOut,cc.removeSelf());\n                    newLabel.runAction(action);\n                    break;\n                }\n            }\n        } \n    },\n\n    setUpPerformanceByData(){\n        //currentDollorLabel\n        var currentDollor = this.dataCenter.playerData.currentDollor;\n        var helper = require(\"helper\");\n        var text = helper.formatNumberShowStyle(currentDollor);\n\n        this.currentDollorLabel.string = \"$ \" + text;\n    },\n\n\n\n\n\n\n\n    openTouchEvent() {\n        this.node.on(\"touchstart\",this.touchBegan,this);\n        this.node.on(\"touchmove\",this.touchMoved,this);\n        this.node.on(\"touchend\",this.touchEnd,this);\n        this.node.on(\"touchcancel\",this.touchCancel,this);\n    },\n    closeTouchEvent(){\n        this.node.off(\"touchstart\",this.touchBegan,this);\n        this.node.off(\"touchmove\",this.touchMoved,this);\n        this.node.off(\"touchend\",this.touchEnd,this);\n        this.node.off(\"touchcancel\",this.touchCancel,this); \n    },\n\n    startRefreshFishes(){\n        var refreshRule = this.dataCenter.getRefreshRuleFromServerByAreaLevel(this.dataCenter.playerData.currentAreaLevel).rules;\n        for (var index in refreshRule) {\n            this.schedule(function(){\n                this.spwanOneFishByFishId(refreshRule[index].fishId, refreshRule[index].probability);\n            },refreshRule[index].timeDelta);\n        }\n    },\n\n    spwanOneFishByFishId(givenFishId,probability){\n        if (probability == null || probability > 10000) {\n            probability = 10000;\n        }\n        var helper = require(\"helper\");\n        if (helper.isHittedByProbability() == false) {\n            return\n        }\n        else {\n            var fishConfig = this.dataCenter.getFishConfigByFishId(givenFishId);\n            cc.loader.loadRes(fishConfig[0],function(err,fishPrefab){\n                var newFish = cc.instantiate(fishPrefab);\n                \n                var spawnAreaNum = Math.random() * 4;\n                spawnAreaNum = Math.floor(spawnAreaNum);\n                var targetAreaNum = this.getTargetAreaNumBySpawnAreaNum(spawnAreaNum);\n\n                var spawnPosition = this.getOneRandomPositionBySpawnArea(spawnAreaNum);\n                newFish.setPosition(spawnPosition);\n                this.fishesNode.addChild(newFish);\n                var fishesMgr = this.fishesNode.getComponent(\"fishesMgr\");\n                fishesMgr.fishConfigs.push(fishConfig);\n\n                var targetPositon = this.getOneRandomPositionBySpawnArea(targetAreaNum);\n                helper.turnOneNodeToOnePosition(newFish,targetPositon);\n\n                var swimLeft = cc.rotateBy(0.5,30);\n                var leftBack = cc.rotateBy(0.5,-30);\n                var swimRight = cc.rotateBy(0.5,-30);\n                var rightBack = cc.rotateBy(0.5,30);\n                var swimAction = cc.sequence(swimLeft,leftBack,swimRight,rightBack);\n                var swimAnimation = cc.repeatForever(swimAction);\n                newFish.runAction(swimAnimation);\n\n                var moveAction = cc.moveTo(this.fishMoveDuration,targetPositon);\n                var fishAction = cc.sequence(moveAction,cc.removeSelf());\n                newFish.runAction(fishAction);\n            });\n        }\n    },\n    getTargetAreaNumBySpawnAreaNum(givenNum) {\n        var target = null;\n        switch(givenNum) {\n            case 0:\n                target = 1;\n                break;\n            case 1:\n                target = 0;\n                break;\n            case 2:\n                target = 3;\n                break;\n            case 3:\n                target = 2;\n                break;\n        }\n        return target;\n    }\n});\n"]}